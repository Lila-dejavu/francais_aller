<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªéŸ³æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .info {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Š èªéŸ³åŠŸèƒ½æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>1. ç€è¦½å™¨æ”¯æ´æª¢æ¸¬</h2>
        <div id="browserSupport" class="info">æª¢æŸ¥ä¸­...</div>
    </div>
    
    <div class="test-section">
        <h2>2. å¯ç”¨èªéŸ³åˆ—è¡¨</h2>
        <div id="voicesList" class="info">è¼‰å…¥ä¸­...</div>
        <button onclick="reloadVoices()">é‡æ–°è¼‰å…¥èªéŸ³</button>
    </div>
    
    <div class="test-section">
        <h2>3. æ¸¬è©¦æœ—è®€</h2>
        <button onclick="testSpeak('Bonjour')">æ¸¬è©¦ "Bonjour"</button>
        <button onclick="testSpeak('Je mappelle Claude')">æ¸¬è©¦ "Je m'appelle Claude"</button>
        <button onclick="testSpeak('Comment allez-vous?')">æ¸¬è©¦ "Comment allez-vous?"</button>
        <button onclick="stopSpeaking()">åœæ­¢æœ—è®€</button>
        <div id="speakStatus" class="info"></div>
    </div>
    
    <div class="test-section">
        <h2>4. ä½¿ç”¨è€…äº’å‹•æ¸¬è©¦</h2>
        <p>ï¼ˆéœ€è¦å…ˆé»æ“ŠæŒ‰éˆ•ï¼ŒæŸäº›ç€è¦½å™¨éœ€è¦ä½¿ç”¨è€…äº’å‹•æ‰èƒ½å•Ÿç”¨èªéŸ³ï¼‰</p>
        <button onclick="enableVoice()">å•Ÿç”¨èªéŸ³åŠŸèƒ½</button>
        <div id="interactionStatus" class="info"></div>
    </div>

    <script>
        let synth = window.speechSynthesis;
        let voices = [];
        let frenchVoice = null;

        // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´
        function checkBrowserSupport() {
            const supportDiv = document.getElementById('browserSupport');
            if ('speechSynthesis' in window) {
                supportDiv.innerHTML = '<span class="success">âœ… ç€è¦½å™¨æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½</span>';
                return true;
            } else {
                supportDiv.innerHTML = '<span class="error">âŒ ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½</span>';
                return false;
            }
        }

        // è¼‰å…¥èªéŸ³
        function loadVoices() {
            voices = synth.getVoices();
            console.log('è¼‰å…¥çš„èªéŸ³æ•¸é‡:', voices.length);
            console.log('æ‰€æœ‰èªéŸ³:', voices);
            
            const voicesDiv = document.getElementById('voicesList');
            
            if (voices.length === 0) {
                voicesDiv.innerHTML = '<span class="error">âš ï¸ æœªæ‰¾åˆ°å¯ç”¨èªéŸ³ã€‚è«‹ç¨å€™å†é‡æ–°è¼‰å…¥...</span>';
                return;
            }
            
            // å°‹æ‰¾æ³•æ–‡èªéŸ³
            const frenchVoices = voices.filter(voice => 
                voice.lang.startsWith('fr') || voice.lang.includes('fr')
            );
            
            frenchVoice = frenchVoices[0] || voices[0];
            
            let html = `<strong>æ‰¾åˆ° ${voices.length} å€‹èªéŸ³</strong><br>`;
            html += `<strong>æ³•æ–‡èªéŸ³: ${frenchVoices.length} å€‹</strong><br><br>`;
            
            if (frenchVoices.length > 0) {
                html += '<span class="success">âœ… å¯ç”¨çš„æ³•æ–‡èªéŸ³ï¼š</span><br>';
                frenchVoices.forEach(voice => {
                    html += `- ${voice.name} (${voice.lang}) ${voice.default ? '[é è¨­]' : ''}<br>`;
                });
            } else {
                html += '<span class="error">âš ï¸ æœªæ‰¾åˆ°æ³•æ–‡èªéŸ³ï¼Œå°‡ä½¿ç”¨é è¨­èªéŸ³</span><br>';
            }
            
            html += '<br>æ‰€æœ‰èªéŸ³ï¼ˆå‰10å€‹ï¼‰ï¼š<br>';
            voices.slice(0, 10).forEach(voice => {
                html += `- ${voice.name} (${voice.lang})<br>`;
            });
            
            voicesDiv.innerHTML = html;
        }

        function reloadVoices() {
            loadVoices();
        }

        // æ¸¬è©¦æœ—è®€
        function testSpeak(text) {
            const statusDiv = document.getElementById('speakStatus');
            
            // å…ˆå–æ¶ˆç•¶å‰æœ—è®€
            synth.cancel();
            
            if (voices.length === 0) {
                statusDiv.innerHTML = '<span class="error">âŒ æ²’æœ‰å¯ç”¨çš„èªéŸ³ã€‚è«‹å…ˆé‡æ–°è¼‰å…¥èªéŸ³ã€‚</span>';
                loadVoices(); // å˜—è©¦é‡æ–°è¼‰å…¥
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = frenchVoice;
            utterance.lang = 'fr-FR';
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            utterance.onstart = () => {
                console.log('é–‹å§‹æœ—è®€:', text);
                statusDiv.innerHTML = `<span class="success">ğŸ”Š æ­£åœ¨æœ—è®€: "${text}"</span>`;
            };
            
            utterance.onend = () => {
                console.log('æœ—è®€çµæŸ');
                statusDiv.innerHTML += '<br><span class="success">âœ… æœ—è®€å®Œæˆ</span>';
            };
            
            utterance.onerror = (event) => {
                console.error('èªéŸ³éŒ¯èª¤:', event);
                statusDiv.innerHTML = `<span class="error">âŒ éŒ¯èª¤: ${event.error}<br>è©³æƒ…: ${event.message || 'ç„¡'}</span>`;
            };
            
            console.log('å˜—è©¦æ’­æ”¾:', utterance);
            synth.speak(utterance);
            
            // æª¢æŸ¥æ˜¯å¦çœŸçš„åœ¨æ’­æ”¾
            setTimeout(() => {
                if (!synth.speaking && !synth.pending) {
                    statusDiv.innerHTML += '<br><span class="error">âš ï¸ èªéŸ³å¯èƒ½æœªèƒ½æ’­æ”¾ã€‚è«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®šæˆ–å˜—è©¦ä½¿ç”¨è€…äº’å‹•æ¸¬è©¦ã€‚</span>';
                }
            }, 100);
        }

        function stopSpeaking() {
            synth.cancel();
            document.getElementById('speakStatus').innerHTML = '<span>â¹ï¸ å·²åœæ­¢</span>';
        }

        // å•Ÿç”¨èªéŸ³ï¼ˆéœ€è¦ä½¿ç”¨è€…äº’å‹•ï¼‰
        function enableVoice() {
            const statusDiv = document.getElementById('interactionStatus');
            
            // æ’­æ”¾ä¸€å€‹çŸ­æš«çš„éœéŸ³ä¾†å•Ÿç”¨èªéŸ³
            const utterance = new SpeechSynthesisUtterance('');
            synth.speak(utterance);
            
            statusDiv.innerHTML = '<span class="success">âœ… èªéŸ³åŠŸèƒ½å·²å•Ÿç”¨</span>';
            
            // ç„¶å¾Œæ¸¬è©¦ä¸€å€‹æ³•æ–‡å–®å­—
            setTimeout(() => {
                testSpeak('Bonjour');
            }, 100);
        }

        // åˆå§‹åŒ–
        checkBrowserSupport();
        loadVoices();

        // ç›£è½èªéŸ³è¼‰å…¥äº‹ä»¶
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }

        // ç­‰å¾…ä¸€ç§’å¾Œå†æ¬¡å˜—è©¦è¼‰å…¥
        setTimeout(() => {
            if (voices.length === 0) {
                console.log('å»¶é²è¼‰å…¥èªéŸ³...');
                loadVoices();
            }
        }, 1000);
    </script>
</body>
</html>
