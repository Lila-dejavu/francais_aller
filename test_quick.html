<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>365法文日记 - 功能测试</h1>
    
    <div id="test1" class="test-section">
        <h2>测试1: 数据加载</h2>
        <p id="test1-result">测试中...</p>
    </div>
    
    <div id="test2" class="test-section">
        <h2>测试2: UI元素</h2>
        <p id="test2-result">测试中...</p>
    </div>
    
    <div id="test3" class="test-section">
        <h2>测试3: 游戏初始化</h2>
        <p id="test3-result">测试中...</p>
    </div>

    <h2>控制台日志：</h2>
    <pre id="console-log"></pre>

    <script src="data.js"></script>
    <script>
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            logs.push('[LOG] ' + args.join(' '));
            originalLog.apply(console, args);
            document.getElementById('console-log').textContent = logs.join('\n');
        };
        
        console.error = function(...args) {
            logs.push('[ERROR] ' + args.join(' '));
            originalError.apply(console, args);
            document.getElementById('console-log').textContent = logs.join('\n');
        };

        // 测试1: 数据加载
        console.log('开始测试1: 数据加载');
        try {
            const day1 = window.getDayContent(1);
            if (day1 && day1.title && day1.questions) {
                document.getElementById('test1-result').textContent = `✅ 成功！第1天: ${day1.title}, 题目数: ${day1.questions.length}`;
                document.getElementById('test1').classList.add('success');
                console.log('测试1通过');
            } else {
                throw new Error('数据格式不正确');
            }
        } catch (error) {
            document.getElementById('test1-result').textContent = `❌ 失败: ${error.message}`;
            document.getElementById('test1').classList.add('error');
            console.error('测试1失败:', error);
        }

        // 测试2: UI元素
        console.log('开始测试2: UI元素');
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const requiredElements = [
                    'currentDay',
                    'completedDays', 
                    'totalStars',
                    'diaryList',
                    'startBtn',
                    'welcomeScreen',
                    'gameScreen'
                ];
                
                const missing = [];
                requiredElements.forEach(id => {
                    if (!document.getElementById(id)) {
                        missing.push(id);
                    }
                });
                
                if (missing.length === 0) {
                    document.getElementById('test2-result').textContent = '✅ 所有必需UI元素都存在';
                    document.getElementById('test2').classList.add('success');
                    console.log('测试2通过');
                } else {
                    document.getElementById('test2-result').textContent = `❌ 缺少元素: ${missing.join(', ')}`;
                    document.getElementById('test2').classList.add('error');
                    console.error('测试2失败，缺少元素:', missing);
                }
                
                // 测试3: 游戏初始化
                console.log('开始测试3: 游戏初始化');
                if (window.game) {
                    document.getElementById('test3-result').textContent = `✅ 游戏已初始化！当前天数: ${window.game.currentDay}, 完成天数: ${window.game.completedDays.length}`;
                    document.getElementById('test3').classList.add('success');
                    console.log('测试3通过');
                } else {
                    document.getElementById('test3-result').textContent = '❌ 游戏未初始化';
                    document.getElementById('test3').classList.add('error');
                    console.error('测试3失败: window.game不存在');
                }
            }, 100);
        });
    </script>
    
    <!-- 加载实际的HTML片段来测试 -->
    <div style="display: none;">
        <div id="currentDay"></div>
        <div id="completedDays"></div>
        <div id="totalStars"></div>
        <div id="diaryList"></div>
        <button id="startBtn">开始</button>
        <div id="welcomeScreen"></div>
        <div id="gameScreen"></div>
    </div>
    
    <script src="game.js"></script>
</body>
</html>
