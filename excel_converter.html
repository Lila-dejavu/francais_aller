<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel é¡Œåº«è½‰æ›å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .example-box {
            background: #f5f7ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .example-box code {
            display: block;
            font-family: 'Courier New', monospace;
            white-space: pre;
            color: #333;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #218838;
        }
        .result-box {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 500px;
            overflow-y: auto;
        }
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #856404;
        }
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #155724;
        }
        .format-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .format-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .format-option:hover {
            border-color: #667eea;
            background: #f5f7ff;
        }
        .format-option.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .format-option h3 {
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .format-option p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .input-helper {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .input-helper small {
            color: #666;
            flex: 1;
            min-width: 200px;
        }
        .separator-btn {
            padding: 8px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .separator-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Excel é¡Œåº«è½‰æ›å·¥å…·</h1>
            <p>å¿«é€Ÿå°‡ Excel ä¸­æ³•å¥å­è½‰æ›æˆéŠæˆ²é¡Œç›®</p>
        </div>
        
        <div class="content">
            <!-- æ­¥é©Ÿ 1: é¸æ“‡æ ¼å¼ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">1</span>
                    <span>é¸æ“‡ Excel æ ¼å¼</span>
                </div>
                <div class="format-selector">
                    <div class="format-option active" onclick="selectFormat('tab')">
                        <h3>ğŸ”– Tab åˆ†éš”</h3>
                        <p>ä¸­æ–‡[Tab]æ³•æ–‡</p>
                    </div>
                    <div class="format-option" onclick="selectFormat('pipe')">
                        <h3>ğŸ“Œ è±ç·šåˆ†éš”</h3>
                        <p>ä¸­æ–‡|æ³•æ–‡</p>
                    </div>
                    <div class="format-option" onclick="selectFormat('comma')">
                        <h3>ğŸ“ é€—è™Ÿåˆ†éš”</h3>
                        <p>ä¸­æ–‡,æ³•æ–‡</p>
                    </div>
                </div>
            </div>

            <!-- æ­¥é©Ÿ 2: è²¼ä¸Šè³‡æ–™ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">2</span>
                    <span>å¾ Excel è¤‡è£½è²¼ä¸Šå¥å­</span>
                </div>
                <div class="example-box">
                    <strong>Excel æ ¼å¼ç¯„ä¾‹:</strong>
                    <code>ä¸­æ–‡å¥å­	æ³•æ–‡å¥å­
æˆ‘é¤“äº†	J'ai faim
æˆ‘æ¸´äº†	J'ai soif
æˆ‘ç´¯äº†	Je suis fatiguÃ©
æ™šå®‰	Bonne nuit</code>
                </div>
                <textarea id="inputText" placeholder="åœ¨é€™è£¡è²¼ä¸Šå¾ Excel è¤‡è£½çš„å…§å®¹...&#10;&#10;ç¯„ä¾‹:&#10;æˆ‘é¤“äº†	J'ai faim&#10;æˆ‘æ¸´äº†	J'ai soif&#10;æˆ‘ç´¯äº†	Je suis fatiguÃ©"></textarea>
                <div class="input-helper">
                    <small>ğŸ’¡ æç¤º: ç›´æ¥å¾ Excel è¤‡è£½è²¼ä¸Šå³å¯,æˆ–æ‰‹å‹•è¼¸å…¥æ™‚å¯é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ’å…¥åˆ†éš”ç¬¦</small>
                    <button class="separator-btn" onclick="insertSeparator()">âœ æ’å…¥åˆ†éš”ç¬¦</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ 3: è½‰æ› -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">3</span>
                    <span>è½‰æ›æˆé¡Œç›®</span>
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="convertToQuestions()">ğŸ”„ è½‰æ›æˆé¡Œç›®</button>
                    <button class="btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
                <div class="info-box" id="statusBox" style="display:none;"></div>
            </div>

            <!-- æ­¥é©Ÿ 4: çµæœ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">4</span>
                    <span>è¤‡è£½çµæœåˆ° custom_questions.js</span>
                </div>
                <div class="result-box" id="resultBox">è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...</div>
                <div class="button-group">
                    <button class="btn-success" onclick="copyResult()">ğŸ“‹ è¤‡è£½çµæœ</button>
                    <button class="btn-primary" onclick="downloadResult()">ğŸ’¾ ä¸‹è¼‰ .js æª”æ¡ˆ</button>
                </div>
                <div class="success-box" id="successBox" style="display:none;">âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿!</div>
            </div>
        </div>
    </div>

    <script>
        let currentFormat = 'tab';
        
        function selectFormat(format) {
            currentFormat = format;
            document.querySelectorAll('.format-option').forEach(el => {
                el.classList.remove('active');
            });
            event.target.closest('.format-option').classList.add('active');
        }

        function convertToQuestions() {
            const input = document.getElementById('inputText').value.trim();
            if (!input) {
                showStatus('âŒ è«‹å…ˆè²¼ä¸Š Excel è³‡æ–™!', 'error');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());
            const questions = [];
            let skipped = 0;

            // é¸æ“‡åˆ†éš”ç¬¦
            let separator = '\t';
            if (currentFormat === 'pipe') separator = '|';
            if (currentFormat === 'comma') separator = ',';

            const skippedLines = []; // è¨˜éŒ„è¢«è·³éçš„è¡Œ

            lines.forEach((line, index) => {
                const parts = line.split(separator).map(p => p.trim());
                
                if (parts.length < 2) {
                    skipped++;
                    skippedLines.push(`ç¬¬ ${index + 1} è¡Œï¼šæ‰¾ä¸åˆ°åˆ†éš”ç¬¦ "${currentFormat === 'tab' ? 'Tab' : separator}"`);
                    return;
                }

                const chinese = parts[0];
                const french = parts[1];

                // è·³éæ¨™é¡Œè¡Œï¼ˆæª¢æŸ¥æ˜¯å¦ç‚ºå¸¸è¦‹çš„æ¨™é¡Œæ–‡å­—ï¼‰
                if (index === 0 && (
                    chinese.toLowerCase().includes('ä¸­æ–‡') || 
                    chinese.toLowerCase().includes('chinese') ||
                    french.toLowerCase().includes('æ³•æ–‡') ||
                    french.toLowerCase().includes('french') ||
                    french.toLowerCase().includes('franÃ§ais')
                )) {
                    skipped++;
                    skippedLines.push(`ç¬¬ ${index + 1} è¡Œï¼šåµæ¸¬åˆ°æ¨™é¡Œè¡Œï¼Œå·²è·³é`);
                    return;
                }

                if (!chinese || !french) {
                    skipped++;
                    skippedLines.push(`ç¬¬ ${index + 1} è¡Œï¼šä¸­æ–‡æˆ–æ³•æ–‡ç‚ºç©º`);
                    return;
                }

                // ç”Ÿæˆé¸æ“‡é¡Œ
                const question = {
                    type: "multiple",
                    question: `ã€Œ${chinese}ã€çš„æ³•æ–‡æ˜¯?`,
                    options: generateOptions(french),
                    answer: 0,
                    frenchText: french,
                    explanation: `${french} æ˜¯ã€Œ${chinese}ã€çš„æ³•æ–‡è¡¨é”ã€‚`,
                    vocabulary: [
                        { french: french.toLowerCase(), chinese: chinese, pronunciation: "è«‹è£œå……ç™¼éŸ³" }
                    ]
                };

                questions.push(question);
            });

            if (questions.length === 0) {
                let errorMsg = 'âŒ æ²’æœ‰æˆåŠŸè½‰æ›ä»»ä½•é¡Œç›®,è«‹æª¢æŸ¥æ ¼å¼!\n\n';
                if (skippedLines.length > 0) {
                    errorMsg += 'è¢«è·³éçš„è¡Œï¼š\n' + skippedLines.join('\n');
                }
                showStatus(errorMsg, 'error');
                return;
            }

            // ç”Ÿæˆ JavaScript ç¨‹å¼ç¢¼
            const result = generateCode(questions);
            document.getElementById('resultBox').textContent = result;
            
            let statusMsg = `âœ… æˆåŠŸè½‰æ› ${questions.length} é¡Œ`;
            if (skipped > 0) {
                statusMsg += ` (è·³é ${skipped} è¡Œ)\n\nè·³éåŸå› ï¼š\n${skippedLines.join('\n')}`;
            }
            showStatus(statusMsg, 'success');
        }

        function generateOptions(correctAnswer) {
            // å¸¸ç”¨çš„å¹²æ“¾é¸é …
            const distractors = [
                "Bonjour", "Merci", "Au revoir", "S'il vous plaÃ®t",
                "Oui", "Non", "Pardon", "Excusez-moi",
                "Je suis", "J'ai", "Tu es", "Il est",
                "Bonne nuit", "Bon matin", "Ã‡a va", "Comment allez-vous"
            ];
            
            const options = [correctAnswer];
            const availableDistractors = distractors.filter(d => d !== correctAnswer);
            
            // éš¨æ©Ÿé¸3å€‹å¹²æ“¾é …
            while (options.length < 4 && availableDistractors.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableDistractors.length);
                options.push(availableDistractors.splice(randomIndex, 1)[0]);
            }
            
            // å¦‚æœå¹²æ“¾é …ä¸å¤ ,è£œå……é€šç”¨é¸é …
            while (options.length < 4) {
                options.push(`é¸é … ${options.length}`);
            }
            
            return options;
        }

        function generateCode(questions) {
            let code = '// å¾ Excel è½‰æ›çš„é¡Œç›®\n// è«‹è¤‡è£½ä»¥ä¸‹å…§å®¹åˆ° custom_questions.js çš„ customQuestions é™£åˆ—ä¸­\n\n';
            
            questions.forEach((q, index) => {
                code += `    // é¡Œç›® ${index + 1}\n`;
                code += `    {\n`;
                code += `        type: "${q.type}",\n`;
                code += `        question: "${q.question}",\n`;
                code += `        options: ${JSON.stringify(q.options)},\n`;
                code += `        answer: ${q.answer},\n`;
                code += `        frenchText: "${q.frenchText}",\n`;
                code += `        explanation: "${q.explanation}",\n`;
                code += `        vocabulary: [\n`;
                code += `            { french: "${q.vocabulary[0].french}", chinese: "${q.vocabulary[0].chinese}", pronunciation: "${q.vocabulary[0].pronunciation}" }\n`;
                code += `        ]\n`;
                code += `    },\n\n`;
            });
            
            return code;
        }

        function showStatus(message, type) {
            const statusBox = document.getElementById('statusBox');
            statusBox.textContent = message;
            statusBox.style.display = 'block';
            statusBox.className = type === 'success' ? 'success-box' : 'info-box';
            
            setTimeout(() => {
                statusBox.style.display = 'none';
            }, 3000);
        }

        function copyResult() {
            const resultBox = document.getElementById('resultBox');
            const text = resultBox.textContent;
            
            if (!text || text === 'è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...') {
                showStatus('âŒ æ²’æœ‰å¯è¤‡è£½çš„å…§å®¹!', 'error');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                const successBox = document.getElementById('successBox');
                successBox.style.display = 'block';
                setTimeout(() => {
                    successBox.style.display = 'none';
                }, 2000);
            });
        }

        function downloadResult() {
            const resultBox = document.getElementById('resultBox');
            const text = resultBox.textContent;
            
            if (!text || text === 'è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...') {
                showStatus('âŒ æ²’æœ‰å¯ä¸‹è¼‰çš„å…§å®¹!', 'error');
                return;
            }
            
            const blob = new Blob([text], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my_questions.js';
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('âœ… å·²ä¸‹è¼‰æª”æ¡ˆ!', 'success');
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('resultBox').textContent = 'è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...';
            showStatus('ğŸ—‘ï¸ å·²æ¸…ç©º', 'success');
        }

        // æ’å…¥åˆ†éš”ç¬¦
        function insertSeparator() {
            const inputField = document.getElementById('inputText');
            const cursorPos = inputField.selectionStart;
            const currentValue = inputField.value;
            
            // æ ¹æ“šç•¶å‰é¸æ“‡çš„æ ¼å¼æ±ºå®šåˆ†éš”ç¬¦
            let separator = '\t';
            if (currentFormat === 'pipe') separator = '|';
            if (currentFormat === 'comma') separator = ',';
            
            // åœ¨æ¸¸æ¨™ä½ç½®æ’å…¥åˆ†éš”ç¬¦
            const newValue = currentValue.substring(0, cursorPos) + 
                            separator + 
                            currentValue.substring(inputField.selectionEnd);
            
            inputField.value = newValue;
            
            // å°‡æ¸¸æ¨™ç§»åˆ°åˆ†éš”ç¬¦ä¹‹å¾Œ
            inputField.selectionStart = inputField.selectionEnd = cursorPos + separator.length;
            inputField.focus();
        }

        // é˜²æ­¢ Tab éµè·³å‡ºè¼¸å…¥æ¡†
        document.addEventListener('DOMContentLoaded', () => {
            const inputText = document.getElementById('inputText');
            inputText.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    insertSeparator();
                }
            });
        });
    </script>
</body>
</html>
