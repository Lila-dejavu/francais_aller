<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel é¡Œåº«è½‰æ›å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .example-box {
            background: #f5f7ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .example-box code {
            display: block;
            font-family: 'Courier New', monospace;
            white-space: pre;
            color: #333;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #218838;
        }
        .result-box {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 500px;
            overflow-y: auto;
        }
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #856404;
        }
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #155724;
        }
        .format-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .format-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .format-option:hover {
            border-color: #667eea;
            background: #f5f7ff;
        }
        .format-option.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .format-option h3 {
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .format-option p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .input-helper {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .input-helper small {
            color: #666;
            flex: 1;
            min-width: 200px;
        }
        .separator-btn {
            padding: 8px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .separator-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Excel é¡Œåº«è½‰æ›å·¥å…·</h1>
            <p>å¿«é€Ÿå°‡ Excel ä¸­æ³•å¥å­è½‰æ›æˆéŠæˆ²é¡Œç›®</p>
        </div>
        
        <div class="content">
            <!-- æ­¥é©Ÿ 1: é¸æ“‡æ ¼å¼ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">1</span>
                    <span>é¸æ“‡ Excel æ ¼å¼</span>
                </div>
                <div class="format-selector">
                    <div class="format-option active" onclick="selectFormat('notebook')">
                        <h3>ğŸ““ ç­†è¨˜æœ¬æ ¼å¼</h3>
                        <p>æ³•æ–‡<br>(ï¼ä¸­æ–‡)</p>
                    </div>
                    <div class="format-option" onclick="selectFormat('tab')">
                        <h3>ğŸ”– Tab åˆ†éš”</h3>
                        <p>ä¸­æ–‡[Tab]æ³•æ–‡</p>
                    </div>
                    <div class="format-option" onclick="selectFormat('pipe')">
                        <h3>ğŸ“Œ è±ç·šåˆ†éš”</h3>
                        <p>ä¸­æ–‡|æ³•æ–‡</p>
                    </div>
                    <div class="format-option" onclick="selectFormat('comma')">
                        <h3>ğŸ“ é€—è™Ÿåˆ†éš”</h3>
                        <p>ä¸­æ–‡,æ³•æ–‡</p>
                    </div>
                </div>
            </div>

            <!-- æ­¥é©Ÿ 2: è²¼ä¸Šè³‡æ–™ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">2</span>
                    <span>å¾ Excel è¤‡è£½è²¼ä¸Šå¥å­</span>
                </div>
                <div class="example-box" id="exampleBox">
                    <strong>ç­†è¨˜æœ¬æ ¼å¼ç¯„ä¾‹:</strong>
                    <code>1. Ã‡a va vraiment m'aider.
( ï¼ é€™çœŸçš„æœ‰å¹«åˆ°æˆ‘ã€‚)
2. J'ai faim.
( ï¼ æˆ‘é¤“äº†ã€‚)
3. Merci beaucoup.
( ï¼ éå¸¸æ„Ÿè¬ã€‚)</code>
                </div>
                <textarea id="inputText" placeholder="åœ¨é€™è£¡è²¼ä¸Šä½ çš„ç­†è¨˜å…§å®¹...&#10;&#10;ç¯„ä¾‹:&#10;Ã‡a va vraiment m'aider.&#10;( ï¼ é€™çœŸçš„æœ‰å¹«åˆ°æˆ‘ã€‚)&#10;J'ai faim.&#10;( ï¼ æˆ‘é¤“äº†ã€‚)"></textarea>
                <div class="input-helper">
                    <small>ğŸ’¡ æç¤º: ç›´æ¥å¾ Excel è¤‡è£½è²¼ä¸Šå³å¯,æˆ–æ‰‹å‹•è¼¸å…¥æ™‚å¯é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ’å…¥åˆ†éš”ç¬¦</small>
                    <button class="separator-btn" onclick="insertSeparator()">âœ æ’å…¥åˆ†éš”ç¬¦</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ 3: è½‰æ› -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">3</span>
                    <span>è½‰æ›æˆé¡Œç›®</span>
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="convertToQuestions()">ğŸ”„ è½‰æ›æˆé¡Œç›®</button>
                    <button class="btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
                <div class="info-box" id="statusBox" style="display:none;"></div>
            </div>

            <!-- æ­¥é©Ÿ 4: è¤‡è£½åŠ å…¥é¡Œåº« -->
            <div class="section">
                <div class="section-title">
                    <span class="step-number">4</span>
                    <span>è¤‡è£½åŠ å…¥é¡Œåº«</span>
                </div>
                <div class="info-box" style="background: #e8f4fd; border-left-color: #2196F3;">
                    ğŸ’¡ <strong>è¶…ç°¡å–®ï¼åªè¦ 3 æ­¥é©Ÿï¼š</strong><br>
                    â‘  é»æ“Šä¸‹æ–¹ã€ŒğŸ“‹ è‡ªå‹•è¤‡è£½ã€æŒ‰éˆ•<br>
                    â‘¡ æ‰“é–‹ <code>custom_questions.js</code> æª”æ¡ˆ<br>
                    â‘¢ æ‰¾åˆ° <strong>ã€ŒğŸ“ æ–°é¡Œç›®è²¼ä¸Šå€ã€</strong>ï¼Œåœ¨æ¨™ç¤ºçš„é‚£ä¸€è¡ŒæŒ‰ <kbd>Ctrl+V</kbd> â†’ å®Œæˆï¼<br>
                    <br>
                    <span style="color: #f44336;">âš ï¸ æé†’ï¼šåªåœ¨æŒ‡å®šå€åŸŸè²¼ä¸Šï¼Œä¸æœƒå½±éŸ¿å‰é¢çš„é¡Œç›®</span>
                </div>
                
                <div class="result-box" id="resultBox">è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...</div>
                
                <div class="button-group">
                    <button class="btn-success" onclick="copyResult()" style="font-size: 1.2em; padding: 18px 35px;">
                        ğŸ“‹ è‡ªå‹•è¤‡è£½ï¼ˆæ¨è–¦ï¼‰
                    </button>
                    <button class="btn-secondary" onclick="openCustomQuestionsFile()">ğŸ“‚ æ‰“é–‹ custom_questions.js</button>
                    <button class="btn-secondary" onclick="downloadResult()">ğŸ’¾ ä¸‹è¼‰å‚™ä»½</button>
                </div>
                <div class="success-box" id="successBox" style="display:none;">
                    âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼<br>
                    <strong>ä¸‹ä¸€æ­¥ï¼š</strong>æ‰“é–‹ custom_questions.jsï¼Œåœ¨é™£åˆ—æœ€å¾ŒæŒ‰ Ctrl+V è²¼ä¸Šå³å¯
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFormat = 'notebook';
        
        function selectFormat(format) {
            currentFormat = format;
            document.querySelectorAll('.format-option').forEach(el => {
                el.classList.remove('active');
            });
            event.target.closest('.format-option').classList.add('active');
            
            // æ›´æ–°ç¯„ä¾‹
            const exampleBox = document.getElementById('exampleBox');
            const inputText = document.getElementById('inputText');
            
            if (format === 'notebook') {
                exampleBox.innerHTML = `<strong>ç­†è¨˜æœ¬æ ¼å¼ç¯„ä¾‹:</strong>
                    <code>1. Ã‡a va vraiment m'aider.
( ï¼ é€™çœŸçš„æœ‰å¹«åˆ°æˆ‘ã€‚)
2. J'ai faim.
( ï¼ æˆ‘é¤“äº†ã€‚)
3. Merci beaucoup.
( ï¼ éå¸¸æ„Ÿè¬ã€‚)</code>`;
                inputText.placeholder = "åœ¨é€™è£¡è²¼ä¸Šä½ çš„ç­†è¨˜å…§å®¹...\n\nç¯„ä¾‹:\n1. Ã‡a va vraiment m'aider.\n( ï¼ é€™çœŸçš„æœ‰å¹«åˆ°æˆ‘ã€‚)\n2. J'ai faim.\n( ï¼ æˆ‘é¤“äº†ã€‚)";
            } else {
                exampleBox.innerHTML = `<strong>Excel æ ¼å¼ç¯„ä¾‹:</strong>
                    <code>ä¸­æ–‡å¥å­	æ³•æ–‡å¥å­
æˆ‘é¤“äº†	J'ai faim
æˆ‘æ¸´äº†	J'ai soif
æˆ‘ç´¯äº†	Je suis fatiguÃ©
æ™šå®‰	Bonne nuit</code>`;
                inputText.placeholder = "åœ¨é€™è£¡è²¼ä¸Šå¾ Excel è¤‡è£½çš„å…§å®¹...\n\nç¯„ä¾‹:\næˆ‘é¤“äº†	J'ai faim\næˆ‘æ¸´äº†	J'ai soif\næˆ‘ç´¯äº†	Je suis fatiguÃ©";
            }
        }

        function convertToQuestions() {
            const input = document.getElementById('inputText').value.trim();
            if (!input) {
                showStatus('âŒ è«‹å…ˆè²¼ä¸Šè³‡æ–™!', 'error');
                return;
            }

            const questions = [];
            let skipped = 0;
            const skippedLines = []; // è¨˜éŒ„è¢«è·³éçš„è¡Œ

            // ç­†è¨˜æœ¬æ ¼å¼è™•ç†
            if (currentFormat === 'notebook') {
                const lines = input.split('\n').map(l => l.trim()).filter(l => l);
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºä¸­æ–‡ç¿»è­¯è¡Œ (åŒ…å«æ‹¬è™Ÿå’Œç­‰è™Ÿ)
                    if (line.match(/[ï¼ˆ(]\s*[=ï¼]\s*.+[ï¼‰)]/)) {
                        continue; // è·³éç¿»è­¯è¡Œï¼Œç­‰å¾…é…å°
                    }
                    
                    // ç§»é™¤é¡Œè™Ÿï¼ˆå¦‚ 1. æˆ– 2. ç­‰ï¼‰
                    let french = line.replace(/^\d+\.\s*/, '').trim();
                    
                    // å¦‚æœç§»é™¤é¡Œè™Ÿå¾Œç‚ºç©ºï¼Œè·³é
                    if (!french) {
                        skipped++;
                        skippedLines.push(`ç¬¬ ${i + 1} è¡Œï¼šç§»é™¤é¡Œè™Ÿå¾Œå…§å®¹ç‚ºç©º`);
                        continue;
                    }
                    
                    const nextLine = i + 1 < lines.length ? lines[i + 1] : '';
                    
                    // æª¢æŸ¥ä¸‹ä¸€è¡Œæ˜¯å¦ç‚ºç¿»è­¯
                    const match = nextLine.match(/[ï¼ˆ(]\s*[=ï¼]\s*(.+)[ï¼‰)]/);
                    
                    if (match) {
                        const chinese = match[1].trim();
                        
                        // ç”Ÿæˆé¸æ“‡é¡Œ
                        const question = {
                            type: "multiple",
                            question: `ã€Œ${chinese}ã€çš„æ³•æ–‡æ˜¯?`,
                            options: generateOptions(french),
                            answer: 0,
                            frenchText: french,
                            explanation: `${french} æ˜¯ã€Œ${chinese}ã€çš„æ³•æ–‡è¡¨é”ã€‚`,
                            vocabulary: [
                                { french: french.toLowerCase(), chinese: chinese, pronunciation: "è«‹è£œå……ç™¼éŸ³" }
                            ]
                        };
                        questions.push(question);
                        i++; // è·³éå·²è™•ç†çš„ç¿»è­¯è¡Œ
                    } else {
                        skipped++;
                        skippedLines.push(`ç¬¬ ${i + 1} è¡Œï¼šæ‰¾ä¸åˆ°å°æ‡‰çš„ä¸­æ–‡ç¿»è­¯`);
                    }
                }
            } else {
                // åŸæœ‰çš„åˆ†éš”ç¬¦æ ¼å¼è™•ç†
                const lines = input.split('\n').filter(line => line.trim());
                
                // é¸æ“‡åˆ†éš”ç¬¦
                let separator = '\t';
                if (currentFormat === 'pipe') separator = '|';
                if (currentFormat === 'comma') separator = ',';

                lines.forEach((line, index) => {
                    const parts = line.split(separator).map(p => p.trim());
                    
                    if (parts.length < 2) {
                        skipped++;
                        skippedLines.push(`ç¬¬ ${index + 1} è¡Œï¼šæ‰¾ä¸åˆ°åˆ†éš”ç¬¦ "${currentFormat === 'tab' ? 'Tab' : separator}"`);
                        return;
                    }

                    const chinese = parts[0];
                    const french = parts[1];

                    // è·³éæ¨™é¡Œè¡Œ
                    if (index === 0 && (
                        chinese.toLowerCase().includes('ä¸­æ–‡') || 
                        chinese.toLowerCase().includes('chinese') ||
                        french.toLowerCase().includes('æ³•æ–‡') ||
                        french.toLowerCase().includes('french') ||
                        french.toLowerCase().includes('franÃ§ais')
                    )) {
                        skipped++;
                        skippedLines.push(`ç¬¬ ${index + 1} è¡Œï¼šåµæ¸¬åˆ°æ¨™é¡Œè¡Œï¼Œå·²è·³é`);
                        return;
                    }

                    if (!chinese || !french) {
                        skipped++;
                        skippedLines.push(`ç¬¬ ${index + 1} è¡Œï¼šä¸­æ–‡æˆ–æ³•æ–‡ç‚ºç©º`);
                        return;
                    }

                    // ç”Ÿæˆé¸æ“‡é¡Œ
                    const question = {
                        type: "multiple",
                        question: `ã€Œ${chinese}ã€çš„æ³•æ–‡æ˜¯?`,
                        options: generateOptions(french),
                        answer: 0,
                        frenchText: french,
                        explanation: `${french} æ˜¯ã€Œ${chinese}ã€çš„æ³•æ–‡è¡¨é”ã€‚`,
                        vocabulary: [
                            { french: french.toLowerCase(), chinese: chinese, pronunciation: "è«‹è£œå……ç™¼éŸ³" }
                        ]
                    };

                    questions.push(question);
                });
            }

            if (questions.length === 0) {
                let errorMsg = 'âŒ æ²’æœ‰æˆåŠŸè½‰æ›ä»»ä½•é¡Œç›®,è«‹æª¢æŸ¥æ ¼å¼!\n\n';
                if (skippedLines.length > 0) {
                    errorMsg += 'è¢«è·³éçš„è¡Œï¼š\n' + skippedLines.join('\n');
                }
                showStatus(errorMsg, 'error');
                return;
            }

            // ç”Ÿæˆ JavaScript ç¨‹å¼ç¢¼
            const result = generateCode(questions);
            document.getElementById('resultBox').textContent = result;
            
            let statusMsg = `âœ… æˆåŠŸè½‰æ› ${questions.length} é¡Œ`;
            if (skipped > 0) {
                statusMsg += ` (è·³é ${skipped} è¡Œ)\n\nè·³éåŸå› ï¼š\n${skippedLines.join('\n')}`;
            }
            showStatus(statusMsg, 'success');
        }

        function generateOptions(correctAnswer) {
            // å¸¸ç”¨çš„å¹²æ“¾é¸é …
            const distractors = [
                "Bonjour", "Merci", "Au revoir", "S'il vous plaÃ®t",
                "Oui", "Non", "Pardon", "Excusez-moi",
                "Je suis", "J'ai", "Tu es", "Il est",
                "Bonne nuit", "Bon matin", "Ã‡a va", "Comment allez-vous"
            ];
            
            const options = [correctAnswer];
            const availableDistractors = distractors.filter(d => d !== correctAnswer);
            
            // éš¨æ©Ÿé¸3å€‹å¹²æ“¾é …
            while (options.length < 4 && availableDistractors.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableDistractors.length);
                options.push(availableDistractors.splice(randomIndex, 1)[0]);
            }
            
            // å¦‚æœå¹²æ“¾é …ä¸å¤ ,è£œå……é€šç”¨é¸é …
            while (options.length < 4) {
                options.push(`é¸é … ${options.length}`);
            }
            
            return options;
        }

        function generateCode(questions) {
            let code = '\n    // === å¾é€™è£¡é–‹å§‹æ˜¯æ–°åŠ å…¥çš„é¡Œç›® ===\n';
            
            questions.forEach((q, index) => {
                code += `    ,{\n`;  // é–‹é ­åŠ é€—è™Ÿï¼Œé¿å…èªæ³•éŒ¯èª¤
                code += `        type: "multiple",\n`;
                code += `        question: "${q.question}",\n`;
                code += `        options: ${JSON.stringify(q.options)},\n`;
                code += `        answer: "${q.options[q.answer]}",\n`;
                code += `        frenchText: "${q.frenchText}",\n`;
                code += `        explanation: "${q.explanation}",\n`;
                code += `        vocabulary: "${q.vocabulary[0].french} - ${q.vocabulary[0].chinese}"\n`;
                code += `    }\n\n`;  // æœ€å¾Œä¸€é¡Œä¸åŠ é€—è™Ÿ
            });
            
            code += '    // === æ–°é¡Œç›®çµæŸ ===\n';
            
            return code;
        }

        function showStatus(message, type) {
            const statusBox = document.getElementById('statusBox');
            statusBox.textContent = message;
            statusBox.style.display = 'block';
            statusBox.className = type === 'success' ? 'success-box' : 'info-box';
            
            setTimeout(() => {
                statusBox.style.display = 'none';
            }, 3000);
        }

        function copyResult() {
            const resultBox = document.getElementById('resultBox');
            const text = resultBox.textContent;
            
            if (!text || text === 'è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...') {
                showStatus('âŒ è«‹å…ˆè½‰æ›é¡Œç›®!', 'error');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                const successBox = document.getElementById('successBox');
                successBox.innerHTML = `
                    âœ… <strong>å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</strong><br>
                    <span style="font-size: 0.95em;">
                    ğŸ“ <strong>ä¸‹ä¸€æ­¥ï¼š</strong><br>
                    1. æ‰“é–‹ <code>custom_questions.js</code><br>
                    2. æ‰¾åˆ° <strong style="color: #667eea;">ã€ŒğŸ“ æ–°é¡Œç›®è²¼ä¸Šå€ï¼ˆå®‰å…¨å€åŸŸï¼‰ã€</strong><br>
                    3. åœ¨æ¨™ç¤º <code>// â† åœ¨é€™ä¸€è¡ŒæŒ‰ Ctrl+V è²¼ä¸Šæ–°é¡Œç›®</code> çš„é‚£ä¸€è¡Œ<br>
                    4. æŒ‰ <kbd>Ctrl+V</kbd> è²¼ä¸Š â†’ å®Œæˆï¼<br>
                    <br>
                    âš ï¸ <strong>åªåœ¨æŒ‡å®šå€åŸŸè²¼ä¸Šï¼Œä¸æœƒå½±éŸ¿å…¶ä»–é¡Œç›®</strong>
                    </span>
                `;
                successBox.style.display = 'block';
                successBox.style.padding = '20px';
                
                setTimeout(() => {
                    successBox.style.display = 'none';
                }, 8000);
            }).catch(err => {
                showStatus('âŒ è¤‡è£½å¤±æ•—: ' + err, 'error');
            });
        }

        function openCustomQuestionsFile() {
            showStatus('ğŸ’¡ è«‹åœ¨ VS Code æˆ–è¨˜äº‹æœ¬ä¸­æ‰“é–‹ custom_questions.js æª”æ¡ˆ', 'success');
        }

        function downloadResult() {
            const resultBox = document.getElementById('resultBox');
            const text = resultBox.textContent;
            
            if (!text || text === 'è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...') {
                showStatus('âŒ æ²’æœ‰å¯ä¸‹è¼‰çš„å…§å®¹!', 'error');
                return;
            }
            
            const blob = new Blob([text], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my_questions.js';
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('âœ… å·²ä¸‹è¼‰æª”æ¡ˆ!', 'success');
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('resultBox').textContent = 'è½‰æ›çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...';
            showStatus('ğŸ—‘ï¸ å·²æ¸…ç©º', 'success');
        }

        // ç§»é™¤çš„å‡½æ•¸ - addToDailyPractice
        function addToDailyPractice_removed() {
            const input = document.getElementById('inputText').value.trim();
            if (!input) {
                showStatus('âŒ è«‹å…ˆè²¼ä¸Šè³‡æ–™!', 'error');
                return;
            }

            // å…ˆè½‰æ›æˆé¡Œç›®
            const questions = [];
            let skipped = 0;

            if (currentFormat === 'notebook') {
                const lines = input.split('\n').map(l => l.trim()).filter(l => l);
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    if (line.match(/[ï¼ˆ(]\s*[=ï¼]\s*.+[ï¼‰)]/)) continue;
                    
                    let french = line.replace(/^\d+\.\s*/, '').trim();
                    if (!french) {
                        skipped++;
                        continue;
                    }
                    
                    const nextLine = i + 1 < lines.length ? lines[i + 1] : '';
                    const match = nextLine.match(/[ï¼ˆ(]\s*[=ï¼]\s*(.+)[ï¼‰)]/);
                    
                    if (match) {
                        const chinese = match[1].trim();
                        questions.push(createSimpleQuestion(french, chinese));
                        i++;
                    } else {
                        skipped++;
                    }
                }
            } else {
                // Excel æ ¼å¼è™•ç†
                const lines = input.split('\n').map(l => l.trim()).filter(l => l);
                
                lines.forEach(line => {
                    let parts;
                    if (currentFormat === 'tab') {
                        parts = line.split('\t');
                    } else if (currentFormat === 'pipe') {
                        parts = line.split('|');
                    } else {
                        parts = line.split(',');
                    }
                    
                    if (parts.length >= 2) {
                        const chinese = parts[0].trim();
                        const french = parts[1].trim();
                        if (chinese && french) {
                            questions.push(createSimpleQuestion(french, chinese));
                        }
                    }
                });
            }

            if (questions.length === 0) {
                showStatus('âŒ æ²’æœ‰æˆåŠŸè½‰æ›ä»»ä½•é¡Œç›®!', 'error');
                return;
            }

            // å„²å­˜åˆ° localStorage
            try {
                // æ ¼å¼åŒ–ç‚ºæ­£ç¢ºçš„çµæ§‹
                const formattedQuestions = questions.map(q => ({
                    type: "multiple",
                    question: q.question,
                    options: q.options,
                    answer: q.options[q.answer], // è½‰æ›ç´¢å¼•ç‚ºå¯¦éš›ç­”æ¡ˆ
                    frenchText: q.frenchText,
                    explanation: q.explanation,
                    vocabulary: `${q.vocabulary[0].french} - ${q.vocabulary[0].chinese}`
                }));

                localStorage.setItem('dailyPracticeQuestions', JSON.stringify(formattedQuestions));
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸¦æä¾›é€£çµ
                const successMsg = document.getElementById('successBox');
                successMsg.innerHTML = `
                    âœ… å·²æˆåŠŸåŠ å…¥ ${questions.length} é¡Œåˆ°æ¯æ—¥ç·´ç¿’ï¼<br>
                    <a href="index.html" style="color: #667eea; text-decoration: underline; font-weight: bold;">
                        â†’ é»æ­¤æ‰“é–‹ä¸»éŠæˆ²é–‹å§‹ç·´ç¿’
                    </a>
                `;
                successMsg.style.display = 'block';
                successMsg.style.padding = '20px';
                successMsg.style.fontSize = '1.1em';
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 10000);

            } catch (error) {
                showStatus('âŒ å„²å­˜å¤±æ•—: ' + error.message, 'error');
            }
        }

        // è¼”åŠ©å‡½æ•¸: å‰µå»ºç°¡å–®é¡Œç›®
        function createSimpleQuestion(french, chinese) {
            return {
                type: "multiple",
                question: `ã€Œ${chinese}ã€çš„æ³•æ–‡æ˜¯?`,
                options: generateOptions(french),
                answer: 0,
                frenchText: french,
                explanation: `${french} æ˜¯ã€Œ${chinese}ã€çš„æ³•æ–‡è¡¨é”ã€‚`,
                vocabulary: [
                    { french: french.toLowerCase(), chinese: chinese, pronunciation: "" }
                ]
            };
        }

        // æ’å…¥åˆ†éš”ç¬¦
        function insertSeparator() {
            const inputField = document.getElementById('inputText');
            const cursorPos = inputField.selectionStart;
            const currentValue = inputField.value;
            
            // æ ¹æ“šç•¶å‰é¸æ“‡çš„æ ¼å¼æ±ºå®šåˆ†éš”ç¬¦
            let separator = '\t';
            if (currentFormat === 'pipe') separator = '|';
            if (currentFormat === 'comma') separator = ',';
            
            // åœ¨æ¸¸æ¨™ä½ç½®æ’å…¥åˆ†éš”ç¬¦
            const newValue = currentValue.substring(0, cursorPos) + 
                            separator + 
                            currentValue.substring(inputField.selectionEnd);
            
            inputField.value = newValue;
            
            // å°‡æ¸¸æ¨™ç§»åˆ°åˆ†éš”ç¬¦ä¹‹å¾Œ
            inputField.selectionStart = inputField.selectionEnd = cursorPos + separator.length;
            inputField.focus();
        }

        // é˜²æ­¢ Tab éµè·³å‡ºè¼¸å…¥æ¡†
        document.addEventListener('DOMContentLoaded', () => {
            const inputText = document.getElementById('inputText');
            inputText.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    insertSeparator();
                }
            });
        });
    </script>
</body>
</html>
