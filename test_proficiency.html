<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç†Ÿç·´åº¦ç³»çµ±æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #4a90e2; }
        h2 { color: #666; margin-top: 0; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-test {
            background: #4a90e2;
            color: white;
        }
        .btn-reset {
            background: #ff6b6b;
            color: white;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .proficiency-level {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            margin: 2px;
            font-size: 12px;
        }
        .level-0 { background: #ff6b6b; color: white; }
        .level-1 { background: #ffa500; color: white; }
        .level-2 { background: #ffd700; color: black; }
        .level-3 { background: #50c878; color: white; }
        .level-4 { background: #4a90e2; color: white; }
        .level-5 { background: #7b68ee; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç†Ÿç·´åº¦ç³»çµ±æ¸¬è©¦å·¥å…·</h1>
    
    <div class="test-section">
        <h2>1. æ¸¬è©¦ç†Ÿç·´åº¦ç®¡ç†å™¨</h2>
        <button class="btn-test" onclick="testProficiencyManager()">æ¸¬è©¦åŸºæœ¬åŠŸèƒ½</button>
        <button class="btn-test" onclick="testWeightCalculation()">æ¸¬è©¦æ¬Šé‡è¨ˆç®—</button>
        <button class="btn-test" onclick="testQuestionSelection()">æ¸¬è©¦é¡Œç›®é¸æ“‡</button>
    </div>
    
    <div class="test-section">
        <h2>2. æŸ¥çœ‹ç•¶å‰ç†Ÿç·´åº¦è³‡æ–™</h2>
        <button class="btn-test" onclick="showProficiencyData()">é¡¯ç¤ºæ‰€æœ‰è³‡æ–™</button>
        <button class="btn-test" onclick="showStatistics()">é¡¯ç¤ºçµ±è¨ˆ</button>
    </div>
    
    <div class="test-section">
        <h2>3. æ¨¡æ“¬å­¸ç¿’éç¨‹</h2>
        <button class="btn-test" onclick="simulateLearning()">æ¨¡æ“¬10æ¬¡å­¸ç¿’</button>
        <button class="btn-test" onclick="testSelectionBias()">æ¸¬è©¦é¸é¡Œåå¥½</button>
    </div>
    
    <div class="test-section">
        <h2>4. è³‡æ–™ç®¡ç†</h2>
        <button class="btn-reset" onclick="resetProficiencyData()">é‡ç½®æ‰€æœ‰ç†Ÿç·´åº¦</button>
        <button class="btn-test" onclick="exportData()">åŒ¯å‡ºè³‡æ–™</button>
    </div>
    
    <div id="result"></div>
    
    <script src="game.js"></script>
    <script>
        const pm = new ProficiencyManager();
        
        function log(message) {
            const result = document.getElementById('result');
            result.textContent = message + '\n' + result.textContent;
        }
        
        function testProficiencyManager() {
            log('=== æ¸¬è©¦ç†Ÿç·´åº¦ç®¡ç†å™¨ ===');
            
            // æ¸¬è©¦è¨˜éŒ„ç†Ÿç·´åº¦
            pm.recordProficiency('Bonjour', 'proficient');
            pm.recordProficiency('Merci', 'not_proficient');
            pm.recordProficiency('Bonjour', 'proficient');
            
            log('å·²è¨˜éŒ„: Bonjour (ç†Ÿç·´x2), Merci (ä¸ç†Ÿç·´x1)');
            log('Bonjour æ¬Šé‡: ' + pm.getWeight('Bonjour'));
            log('Merci æ¬Šé‡: ' + pm.getWeight('Merci'));
            log('æ–°å¥å­æ¬Šé‡: ' + pm.getWeight('Au revoir'));
            log('âœ… åŸºæœ¬åŠŸèƒ½æ¸¬è©¦å®Œæˆ\n');
        }
        
        function testWeightCalculation() {
            log('=== æ¸¬è©¦æ¬Šé‡è¨ˆç®— ===');
            
            const testCases = [
                { text: 'Level 0', level: 0 },
                { text: 'Level 1', level: 1 },
                { text: 'Level 2', level: 2 },
                { text: 'Level 3', level: 3 },
                { text: 'Level 4', level: 4 },
                { text: 'Level 5', level: 5 }
            ];
            
            testCases.forEach(tc => {
                // æ‰‹å‹•è¨­å®šç­‰ç´š
                pm.proficiencyData[tc.text] = {
                    level: tc.level,
                    lastReviewed: new Date().toISOString(),
                    reviewCount: 1
                };
                const weight = pm.getWeight(tc.text);
                log(`${tc.text}: æ¬Šé‡ = ${weight.toFixed(2)}`);
            });
            
            pm.saveProficiency();
            log('âœ… æ¬Šé‡è¨ˆç®—æ¸¬è©¦å®Œæˆ\n');
        }
        
        function testQuestionSelection() {
            log('=== æ¸¬è©¦é¡Œç›®é¸æ“‡ ===');
            
            // å‰µå»ºæ¸¬è©¦é¡Œç›®
            const testQuestions = [];
            for (let i = 1; i <= 50; i++) {
                testQuestions.push({
                    question: `æ¸¬è©¦å¥å­ ${i}`,
                    frenchText: `Test ${i}`,
                    answer: `Answer ${i}`
                });
            }
            
            // è¨­å®šä¸€äº›ç†Ÿç·´åº¦
            for (let i = 1; i <= 20; i++) {
                pm.proficiencyData[`Test ${i}`] = {
                    level: Math.floor(i / 4), // 0-5
                    lastReviewed: new Date().toISOString(),
                    reviewCount: i
                };
            }
            pm.saveProficiency();
            
            const selected = pm.selectQuestions(testQuestions, 30);
            log(`å¾ ${testQuestions.length} é¡Œä¸­é¸å‡º ${selected.length} é¡Œ`);
            
            const stats = pm.getProficiencyStats(selected);
            log('ç†Ÿç·´åº¦åˆ†å¸ƒ:');
            log(`  ğŸ†• æ–°é¡Œç›®: ${stats.new}`);
            log(`  âŒ ä½ç†Ÿç·´: ${stats.low}`);
            log(`  ğŸ“š ä¸­ç­‰: ${stats.medium}`);
            log(`  âœ… é«˜ç†Ÿç·´: ${stats.high}`);
            log('âœ… é¡Œç›®é¸æ“‡æ¸¬è©¦å®Œæˆ\n');
        }
        
        function showProficiencyData() {
            log('=== ç•¶å‰ç†Ÿç·´åº¦è³‡æ–™ ===');
            
            const data = pm.proficiencyData;
            const entries = Object.entries(data);
            
            if (entries.length === 0) {
                log('âŒ ç›®å‰æ²’æœ‰ä»»ä½•ç†Ÿç·´åº¦è³‡æ–™');
                return;
            }
            
            entries.sort((a, b) => a[1].level - b[1].level);
            
            entries.forEach(([text, info]) => {
                const levelClass = `level-${info.level}`;
                const date = new Date(info.lastReviewed).toLocaleString('zh-TW');
                log(`${text}: Level ${info.level} | è¤‡ç¿’ ${info.reviewCount} æ¬¡ | ${date}`);
            });
            
            log(`\nç¸½è¨ˆ: ${entries.length} å€‹å¥å­\n`);
        }
        
        function showStatistics() {
            log('=== ç†Ÿç·´åº¦çµ±è¨ˆ ===');
            
            const data = pm.proficiencyData;
            const entries = Object.entries(data);
            
            if (entries.length === 0) {
                log('âŒ ç›®å‰æ²’æœ‰ä»»ä½•è³‡æ–™');
                return;
            }
            
            const stats = {
                total: entries.length,
                byLevel: [0, 0, 0, 0, 0, 0],
                totalReviews: 0,
                avgLevel: 0
            };
            
            entries.forEach(([_, info]) => {
                stats.byLevel[info.level]++;
                stats.totalReviews += info.reviewCount;
                stats.avgLevel += info.level;
            });
            
            stats.avgLevel /= stats.total;
            
            log(`ç¸½å¥å­æ•¸: ${stats.total}`);
            log(`ç¸½è¤‡ç¿’æ¬¡æ•¸: ${stats.totalReviews}`);
            log(`å¹³å‡ç†Ÿç·´åº¦: ${stats.avgLevel.toFixed(2)}`);
            log('\nå„ç­‰ç´šåˆ†å¸ƒ:');
            stats.byLevel.forEach((count, level) => {
                const percentage = ((count / stats.total) * 100).toFixed(1);
                log(`  Level ${level}: ${count} å¥ (${percentage}%)`);
            });
            log('');
        }
        
        function simulateLearning() {
            log('=== æ¨¡æ“¬å­¸ç¿’éç¨‹ ===');
            
            const sentences = ['Bonjour', 'Merci', 'Au revoir', 'Comment allez-vous?', 'Je m\'appelle'];
            
            log('é–‹å§‹æ¨¡æ“¬ 10 æ¬¡ç·´ç¿’...\n');
            
            for (let i = 1; i <= 10; i++) {
                const sentence = sentences[Math.floor(Math.random() * sentences.length)];
                const level = Math.random() > 0.7 ? 'not_proficient' : 'proficient';
                pm.recordProficiency(sentence, level);
                log(`ç¬¬ ${i} æ¬¡: ${sentence} â†’ ${level === 'proficient' ? 'âœ…' : 'âŒ'}`);
            }
            
            log('\næœ€çµ‚çµæœ:');
            sentences.forEach(s => {
                const data = pm.proficiencyData[s];
                if (data) {
                    log(`${s}: Level ${data.level}, æ¬Šé‡ ${pm.getWeight(s).toFixed(2)}`);
                }
            });
            log('');
        }
        
        function testSelectionBias() {
            log('=== æ¸¬è©¦é¸é¡Œåå¥½ï¼ˆ1000æ¬¡ï¼‰ ===');
            
            // å‰µå»º3å€‹ä¸åŒç†Ÿç·´åº¦çš„é¡Œç›®
            const questions = [
                { frenchText: 'Low', answer: 'Low' },
                { frenchText: 'Medium', answer: 'Medium' },
                { frenchText: 'High', answer: 'High' }
            ];
            
            pm.proficiencyData = {
                'Low': { level: 0, lastReviewed: new Date().toISOString(), reviewCount: 1 },
                'Medium': { level: 3, lastReviewed: new Date().toISOString(), reviewCount: 1 },
                'High': { level: 5, lastReviewed: new Date().toISOString(), reviewCount: 1 }
            };
            pm.saveProficiency();
            
            const counts = { 'Low': 0, 'Medium': 0, 'High': 0 };
            
            // é‡è¤‡é¸é¡Œ1000æ¬¡
            for (let i = 0; i < 1000; i++) {
                const selected = pm.selectQuestions(questions, 1);
                counts[selected[0].frenchText]++;
            }
            
            const total = counts.Low + counts.Medium + counts.High;
            log(`Low (Level 0): ${counts.Low} æ¬¡ (${(counts.Low/total*100).toFixed(1)}%)`);
            log(`Medium (Level 3): ${counts.Medium} æ¬¡ (${(counts.Medium/total*100).toFixed(1)}%)`);
            log(`High (Level 5): ${counts.High} æ¬¡ (${(counts.High/total*100).toFixed(1)}%)`);
            log('\nâœ… å¯ä»¥çœ‹å‡ºä½ç†Ÿç·´åº¦çš„é¡Œç›®è¢«é¸ä¸­çš„æ©Ÿæœƒæ˜é¡¯è¼ƒé«˜\n');
        }
        
        function resetProficiencyData() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰ç†Ÿç·´åº¦è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                localStorage.removeItem('frenchDiary_proficiency');
                pm.proficiencyData = {};
                log('âœ… å·²é‡ç½®æ‰€æœ‰ç†Ÿç·´åº¦è³‡æ–™\n');
            }
        }
        
        function exportData() {
            const data = JSON.stringify(pm.proficiencyData, null, 2);
            log('=== åŒ¯å‡ºè³‡æ–™ ===');
            log(data);
            log('\nå¯ä»¥è¤‡è£½ä¸Šé¢çš„è³‡æ–™é€²è¡Œå‚™ä»½\n');
        }
        
        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºæ­¡è¿è¨Šæ¯
        window.onload = function() {
            log('ğŸ“Š ç†Ÿç·´åº¦ç³»çµ±æ¸¬è©¦å·¥å…·å·²è¼‰å…¥');
            log('é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦\n');
        };
    </script>
</body>
</html>
